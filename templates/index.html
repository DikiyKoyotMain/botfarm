<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Town - Изометрическая Ферма</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8c0 50%, #6bc6a3 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        /* Изометрическая игровая область */
        .game-world {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #90EE90 25%, transparent 25%), 
                        linear-gradient(-45deg, #90EE90 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #90EE90 75%), 
                        linear-gradient(-45deg, transparent 75%, #90EE90 75%);
            background-size: 40px 40px;
            background-position: 0 0, 0 20px, 20px -20px, -20px 0px;
            transform: perspective(1000px) rotateX(45deg) scale(0.8);
            transform-origin: center center;
        }

        /* UI элементы */
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
        }

        /* Верхняя панель с ресурсами */
        .top-resources {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 200;
        }

        .resource-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        .resource-icon:hover {
            transform: scale(1.1);
        }

        .resource-count {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Кнопки действий */
        .action-buttons {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 200;
        }

        .action-btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            pointer-events: auto !important;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        /* Магазин */
        .shop-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .shop-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 25px;
            margin: 20px;
            max-width: 400px;
            max-height: 80vh;
            margin: 50px auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            color: white;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .shop-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .shop-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .shop-tab {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shop-tab.active {
            background: rgba(255,255,255,0.3);
        }

        .shop-items {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .shop-item {
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: auto !important;
            touch-action: manipulation;
        }

        .shop-item:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .shop-close {
            background: #e74c3c;
            width: 100%;
        }

        /* Кастомный скроллбар для магазина */
        .shop-content::-webkit-scrollbar {
            width: 8px;
        }

        .shop-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .shop-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        .shop-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        .shop-items::-webkit-scrollbar {
            width: 6px;
        }

        .shop-items::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .shop-items::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }

        .shop-items::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        /* Логин секция */
        .login-section {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            min-width: 300px;
        }

        .login-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 16px;
            pointer-events: auto !important;
            background: white;
            color: #333;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            touch-action: manipulation;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: auto !important;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        /* Игровые объекты */
        .game-object {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            z-index: 10;
            border: 3px solid #fff;
        }

        .game-object.building {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 12px 35px rgba(0,0,0,0.5);
        }

        .game-object.building.house {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .game-object.building.windmill {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .game-object.building.farm {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .game-object.building.warehouse {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .game-object.building.factory {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }

        .game-object.building.silo {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        }

        .game-object.building.mine {
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
        }

        .game-object.building.refinery {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
        }

        .game-object.tree {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .game-object.water {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        /* Режим размещения */
        .placement-mode {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            z-index: 1000;
            font-size: 18px;
        }

        .game-world.placement-mode {
            cursor: crosshair;
        }

        .game-world.placement-mode .game-object {
            pointer-events: none;
        }

        /* Подсветка при наведении в режиме размещения */
        .placement-preview {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 3px dashed #fff;
            border-radius: 15px;
            background: rgba(255,255,255,0.2);
            pointer-events: none;
            z-index: 5;
        }
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .water {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        /* Анимации */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        /* Уведомления */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Специальные стили для Telegram Web App */
        @media (max-width: 768px) {
            input, button, .action-btn, .shop-item, .login-button {
                pointer-events: auto !important;
                touch-action: manipulation !important;
                -webkit-tap-highlight-color: transparent !important;
                -webkit-touch-callout: none !important;
                -webkit-user-select: none !important;
                -khtml-user-select: none !important;
                -moz-user-select: none !important;
                -ms-user-select: none !important;
                user-select: none !important;
            }
            
            input {
                -webkit-user-select: text !important;
                -moz-user-select: text !important;
                -ms-user-select: text !important;
                user-select: text !important;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Изометрическая игровая область -->
        <div class="game-world" id="gameWorld">
            <!-- Игровые объекты будут добавляться динамически -->
        </div>

        <!-- UI элементы -->
        <div class="ui-overlay">
            <!-- Секция входа -->
            <div id="loginSection" class="login-section">
                <div class="login-title">🌾 Farm Town</div>
                <p style="margin-bottom: 20px; color: #666;">Добро пожаловать в изометрическую ферму!</p>
                <input type="text" id="name" placeholder="Введите ваше имя" class="login-input">
                <button onclick="createPlayer()" class="login-button">Начать игру</button>
            </div>

            <!-- Верхняя панель ресурсов -->
            <div id="topResources" class="top-resources" style="display: none;">
                <div class="resource-icon" style="background: #f39c12;" onclick="showResourceInfo('gold', 'Золото')">
                    🥇
                    <div class="resource-count" id="goldCount">730</div>
                </div>
                <div class="resource-icon" style="background: #8b4513;" onclick="showResourceInfo('wheat', 'Пшеница')">
                    🌾
                    <div class="resource-count" id="bagsCount">0</div>
                </div>
                <div class="resource-icon" style="background: #e74c3c;" onclick="showResourceInfo('cotton', 'Хлопок')">
                    🌱
                    <div class="resource-count" id="bricksCount">0</div>
                </div>
                <div class="resource-icon" style="background: #3498db;" onclick="showResourceInfo('wood', 'Дерево')">
                    🪵
                    <div class="resource-count" id="barrelsCount">0</div>
                </div>
                <div class="resource-icon" style="background: #27ae60;" onclick="showResourceInfo('milk', 'Молоко')">
                    🥛
                    <div class="resource-count" id="plantsCount">0</div>
                </div>
            </div>

            <!-- Кнопки действий -->
            <div id="actionButtons" class="action-buttons" style="display: none;">
                <button class="action-btn" onclick="openShop()" title="Магазин">🏪</button>
                <button class="action-btn" onclick="startPlacement()" title="Разместить здание">📍</button>
                <button class="action-btn" onclick="transportToWarehouse()" title="Транспортировать на склад">🚚</button>
                <button class="action-btn" onclick="sellGoods()" title="Продать товары">💰</button>
                <button class="action-btn" onclick="rotateView()" title="Повернуть вид">🔄</button>
                <button class="action-btn" onclick="removeObject()" title="Удалить объект">💣</button>
            </div>
        </div>
    </div>

    <!-- Магазин -->
    <div id="shopModal" class="shop-modal">
        <div class="shop-content">
            <div class="shop-title">🏪 Магазин</div>
            
            <div class="shop-tabs">
                <button class="shop-tab active" onclick="switchTab('buildings')">🏗️ Здания</button>
                <button class="shop-tab" onclick="switchTab('workers')">👷 Работники</button>
                <button class="shop-tab" onclick="switchTab('vehicles')">🚛 Техника</button>
            </div>

            <div id="buildingsTab" class="shop-items">
                <!-- FARM -->
                <button class="shop-item" onclick="buyItem('cotton_field', 'Хлопковое поле', 250)">🌱 Хлопковое поле (250$)</button>
                <button class="shop-item" onclick="buyItem('sugarcane_field', 'Сахарное поле', 250)">🎋 Сахарное поле (250$)</button>
                <button class="shop-item" onclick="buyItem('wheat_field', 'Пшеничное поле', 250)">🌾 Пшеничное поле (250$)</button>
                <button class="shop-item" onclick="buyItem('tree_farm', 'Лесная ферма', 500)">🌳 Лесная ферма (500$)</button>
                <button class="shop-item" onclick="buyItem('well', 'Колодец', 1250)">💧 Колодец (1250$)</button>
                <button class="shop-item" onclick="buyItem('farm_house', 'Фермерский дом', 1250)">🏠 Фермерский дом (1250$)</button>
                <button class="shop-item" onclick="buyItem('salt_field', 'Соляное поле', 1250)">🧂 Соляное поле (1250$)</button>
                <button class="shop-item" onclick="buyItem('lumberjack_house', 'Дом лесоруба', 2500)">🪓 Дом лесоруба (2500$)</button>
                <button class="shop-item" onclick="buyItem('wood_shed', 'Дровяной сарай', 5000)">🪵 Дровяной сарай (5000$)</button>
                <button class="shop-item" onclick="buyItem('silo', 'Силос', 10000)">🗼 Силос (10000$)</button>
                <button class="shop-item" onclick="buyItem('storehouse', 'Склад', 20000)">🏪 Склад (20000$)</button>
                <button class="shop-item" onclick="buyItem('wind_pump', 'Ветряной насос', 25000)">💨 Ветряной насос (25000$)</button>
                <button class="shop-item" onclick="buyItem('wind_mill', 'Ветряная мельница', 15000)">🌪️ Ветряная мельница (15000$)</button>
                <button class="shop-item" onclick="buyItem('bakery', 'Пекарня', 200000)">🥖 Пекарня (200000$)</button>
                <button class="shop-item" onclick="buyItem('cakery', 'Кондитерская', 250000)">🎂 Кондитерская (250000$)</button>
                
                <!-- RANCH -->
                <button class="shop-item" onclick="buyItem('ranch_house', 'Ранчо', 1250)">🐄 Ранчо (1250$)</button>
                <button class="shop-item" onclick="buyItem('feed_mill', 'Кормовой завод', 5000)">🌾 Кормовой завод (5000$)</button>
                <button class="shop-item" onclick="buyItem('trough', 'Кормушка', 5000)">🥣 Кормушка (5000$)</button>
                <button class="shop-item" onclick="buyItem('chicken_coop', 'Курятник', 30000)">🐔 Курятник (30000$)</button>
                <button class="shop-item" onclick="buyItem('sheep_pen', 'Овчарня', 40000)">🐑 Овчарня (40000$)</button>
                <button class="shop-item" onclick="buyItem('milk_barn', 'Молочная ферма', 50000)">🥛 Молочная ферма (50000$)</button>
                
                <!-- TERRAIN -->
                <button class="shop-item" onclick="buyItem('dirt_road', 'Грунтовая дорога', 1000)">🛣️ Грунтовая дорога (1000$)</button>
                <button class="shop-item" onclick="buyItem('pasture', 'Пастбище', 5000)">🌿 Пастбище (5000$)</button>
                <button class="shop-item" onclick="buyItem('paved_road', 'Асфальтовая дорога', 10000)">🛣️ Асфальтовая дорога (10000$)</button>
                <button class="shop-item" onclick="buyItem('pond', 'Пруд', 20000)">🌊 Пруд (20000$)</button>
                
                <!-- INDUSTRIAL -->
                <button class="shop-item" onclick="buyItem('oil_pump', 'Нефтяная вышка', 1250)">⛽ Нефтяная вышка (1250$)</button>
                <button class="shop-item" onclick="buyItem('water_pump', 'Водяной насос', 5000)">💧 Водяной насос (5000$)</button>
                <button class="shop-item" onclick="buyItem('water_tower', 'Водонапорная башня', 5000)">🗼 Водонапорная башня (5000$)</button>
                <button class="shop-item" onclick="buyItem('warehouse', 'Склад', 10000)">🏭 Склад (10000$)</button>
                <button class="shop-item" onclick="buyItem('wind_turbine', 'Ветряная турбина', 2500)">💨 Ветряная турбина (2500$)</button>
                <button class="shop-item" onclick="buyItem('worker_house', 'Дом рабочего', 2500)">🏠 Дом рабочего (2500$)</button>
                <button class="shop-item" onclick="buyItem('refinery', 'Нефтеперерабатывающий завод', 15000)">🏭 Нефтеперерабатывающий завод (15000$)</button>
                <button class="shop-item" onclick="buyItem('iron_mine', 'Железный рудник', 25000)">⛏️ Железный рудник (25000$)</button>
                <button class="shop-item" onclick="buyItem('lumber_mill', 'Лесопилка', 50000)">🪵 Лесопилка (50000$)</button>
                <button class="shop-item" onclick="buyItem('power_plant', 'Электростанция', 100000)">⚡ Электростанция (100000$)</button>
                <button class="shop-item" onclick="buyItem('fabric_plant', 'Текстильная фабрика', 250000)">🧵 Текстильная фабрика (250000$)</button>
                
                <!-- TRADE -->
                <button class="shop-item" onclick="buyItem('trade_depot', 'Торговая база', 5000)">📦 Торговая база (5000$)</button>
                <button class="shop-item" onclick="buyItem('trade_pier', 'Торговый причал', 10000)">🚢 Торговый причал (10000$)</button>
                <button class="shop-item" onclick="buyItem('neighbor_delivery', 'Доставка соседям', 15000)">🚚 Доставка соседям (15000$)</button>
            </div>

            <div id="workersTab" class="shop-items" style="display: none;">
                <button class="shop-item" onclick="buyItem('farmer', 'Фермер', 12)">👨‍🌾 Фермер (12$/мин)</button>
                <button class="shop-item" onclick="buyItem('lumberjack', 'Лесоруб', 120)">🪓 Лесоруб (120$/мин)</button>
                <button class="shop-item" onclick="buyItem('rancher', 'Ранчер', 12)">🐄 Ранчер (12$/мин)</button>
                <button class="shop-item" onclick="buyItem('industrial_worker', 'Промышленный рабочий', 72)">🏭 Промышленный рабочий (72$/мин)</button>
                <button class="shop-item" onclick="buyItem('faster_farmer', 'Быстрый фермер', 180)">🚜 Быстрый фермер (180$/мин)</button>
                <button class="shop-item" onclick="buyItem('faster_lumberjack', 'Быстрый лесоруб', 180)">⚡ Быстрый лесоруб (180$/мин)</button>
                <button class="shop-item" onclick="buyItem('faster_rancher', 'Быстрый ранчер', 180)">🏎️ Быстрый ранчер (180$/мин)</button>
                <button class="shop-item" onclick="buyItem('faster_worker', 'Быстрый рабочий', 60)">⚡ Быстрый рабочий (60$/мин)</button>
            </div>

            <div id="vehiclesTab" class="shop-items" style="display: none;">
                <button class="shop-item" onclick="buyItem('farm_tractor', 'Фермерский трактор', 175000)">🚜 Фермерский трактор (175000$)</button>
                <button class="shop-item" onclick="buyItem('atv', 'Квадроцикл', 50000)">🏎️ Квадроцикл (50000$)</button>
                <button class="shop-item" onclick="buyItem('forklift', 'Погрузчик', 125000)">🚛 Погрузчик (125000$)</button>
            </div>

            <button class="shop-item shop-close" onclick="closeShop()">Закрыть</button>
        </div>
    </div>

    <script src="/static/main.js"></script>
</body>
</html> 